{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NavBar - Panel</title>
    <!-- Referencia CSS -->
    <link rel="stylesheet" href="{% static 'css/panel.css' %}">
    {% include 'referencias.html' %}
</head>

<body>
    <nav class="navbar fixed-top navbar-expand-lg navbar-petcare">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'index' %}">
                <img src="{% static 'img/logo.png' %}" alt="logo" class="logo-navbar">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Menú">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="{% url 'servicios' %}">Servicios</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'citas' %}">Citas</a></li>
                </ul>

                <!-- derecha -->
                <div class="ms-auto d-flex align-items-center gap-3">
                    <!-- Toggle tema -->
                    <label class="toggle ms-2">
                        <input type="checkbox" class="input" id="theme-switch" />
                        <div class="icon icon--moon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="28" height="28"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="icon icon--sun">
                            <!-- Sol icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="28" height="28"
                                fill="currentColor">
                                <path
                                    d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75z
                                        M7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0z
                                        M18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59z
                                        M21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75z
                                        M17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591z
                                        M12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18z
                                        M7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59z
                                        M6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12z
                                        M6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z">
                                </path>
                            </svg>
                        </div>
                    </label>

                    <!-- Logout -->
                    <form method="post" action="">
                        {% csrf_token %}
                        <button type="submit" class="btn-logout" aria-label="Cerrar sesión" title="Cerrar sesión">
                            <div class="sign">
                                <svg viewBox="0 0 512 512" aria-hidden="true" focusable="false">
                                    <path
                                        d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z" />
                                </svg>
                            </div>
                            <div class="text">{% if user.is_authenticated %}
                                <a href="{% url 'logout' %}">Cerrar sesión</a>
                                {% endif %}
                            </div>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </nav>
    <script>
        (function () {
            const nav = document.querySelector('.navbar-petcare');
            const setNavbarVar = () => {
                const h = nav ? nav.offsetHeight : 64;
                document.documentElement.style.setProperty('--navbar-h', h + 'px');
            };
            setNavbarVar();
            window.addEventListener('resize', setNavbarVar);

            // ===== Marcar link activo según URL
            const navLinks = Array.from(document.querySelectorAll('.navbar-petcare .nav-link'));
            const path = location.pathname.replace(/\/+$/, '');
            const norm = (url) => {
                try {
                    const u = new URL(url, location.origin);
                    return u.pathname.replace(/\/+$/, '');
                } catch { return url; }
            };

            let marked = false;
            navLinks.forEach(a => {
                const hrefPath = norm(a.getAttribute('href'));
                if (hrefPath && hrefPath === path) {
                    a.classList.add('active');
                    marked = true;
                } else {
                    a.classList.remove('active');
                }
            });

            if (!marked) {
                navLinks.some(a => {
                    const hrefPath = norm(a.getAttribute('href'));
                    if (hrefPath !== '/' && path.startsWith(hrefPath)) {
                        a.classList.add('active');
                        return true;
                    }
                    return false;
                });
            }

            // ===== Cerrar el collapse al hacer click en un link (MÓVIL)
            const navbarNav = document.getElementById('navbarNav');
            if (navbarNav && window.bootstrap) {
                const bsCollapse = new bootstrap.Collapse(navbarNav, { toggle: false });

                navLinks.forEach(a => {
                    a.addEventListener('click', () => {
                        if (window.innerWidth < 992) { // solo en móvil / tablet
                            bsCollapse.hide();
                        }
                    });
                });
            }
        })();
    </script>


</body>

</html>